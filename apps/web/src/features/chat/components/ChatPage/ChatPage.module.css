/* ============================================================================
   Chat Interface Styles
   ============================================================================
   Full-screen chat experience for mobile and desktop.

   Layout structure:
   - Fixed header at top (minimal branding)
   - Scrollable message area (fills remaining space)
   - Fixed input area at bottom

   Using dvh (dynamic viewport height) for proper mobile behavior
   when the keyboard appears/disappears.
   ============================================================================ */

/* ----------------------------------------------------------------------------
   Container
   ----------------------------------------------------------------------------
   Full viewport container using flexbox for the three-section layout.
   ---------------------------------------------------------------------------- */
.container {
  /* Fill the entire viewport */
  height: 100dvh;
  width: 100%;

  /* Flex column layout for mobile */
  display: flex;
  flex-direction: column;

  /* Subtle background color */
  background-color: var(--color-background-secondary);
}

/* Desktop: flex row for sidebar + chat main */
@media (min-width: 768px) {
  .container {
    flex-direction: row;
  }
}

/* ----------------------------------------------------------------------------
   Header
   ----------------------------------------------------------------------------
   Minimal header with just the app logo.
   Fixed height, doesn't scroll with messages.
   ---------------------------------------------------------------------------- */
.header {
  /* Fixed height */
  height: var(--header-height);

  /* Center content, with relative positioning for absolute buttons */
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;

  /* Visual separation from messages */
  background-color: var(--color-surface);
  border-bottom: 1px solid var(--border-color);

  /* Prevent shrinking */
  flex-shrink: 0;
}

.logo {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);

  /* Reset default margins */
  margin: 0;
}

/* ----------------------------------------------------------------------------
   Messages Area
   ----------------------------------------------------------------------------
   Scrollable container for message bubbles.
   Grows to fill available space between header and input.
   ---------------------------------------------------------------------------- */
.messages {
  /* Grow to fill space */
  flex: 1;

  /* Enable scrolling */
  overflow-y: auto;

  /* Padding around messages */
  padding: var(--spacing-md);

  /* Flex column for message stacking */
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

/* ----------------------------------------------------------------------------
   Welcome Message
   ----------------------------------------------------------------------------
   Shown when the conversation is empty.
   ---------------------------------------------------------------------------- */
.welcome {
  /* Center in the messages area */
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;

  /* Padding */
  padding: var(--spacing-xl);
}

.welcomeText {
  /* Centered, readable width */
  max-width: 400px;
  text-align: center;

  /* Muted appearance */
  color: var(--color-text-secondary);
  font-size: var(--font-size-base);
  line-height: var(--line-height-relaxed);
}

/* ----------------------------------------------------------------------------
   Message Row
   ----------------------------------------------------------------------------
   Container for each message, handles alignment.
   ---------------------------------------------------------------------------- */
.messageRow {
  /* Default: left-aligned (assistant messages) */
  display: flex;
  justify-content: flex-start;
}

.messageRowUser {
  /* User messages: right-aligned */
  justify-content: flex-end;
}

/* ----------------------------------------------------------------------------
   Message Bubble
   ----------------------------------------------------------------------------
   The actual message content container.
   Different styles for user/assistant/system messages.
   ---------------------------------------------------------------------------- */
.bubble {
  /* Limit width for readability */
  max-width: 80%;

  /* Padding inside bubble */
  padding: var(--spacing-sm) var(--spacing-md);

  /* Rounded corners - 18px as per design spec */
  border-radius: 18px;

  /* Default (assistant) styling - uses CSS variable for dark mode support */
  background-color: var(--color-neutral-100);
  color: var(--color-text-primary);

  /* Subtle shadow */
  box-shadow: var(--shadow-sm);

  /* Larger font for chat messages */
  font-size: var(--font-size-lg);
}

/* User message styling - primary gradient, right side */
.bubbleUser {
  background: var(--color-primary-gradient);
  color: var(--color-text-inverse);

  /* Less rounded bottom-right corner */
  border-bottom-right-radius: var(--radius-sm);
}

/* Assistant message styling - neutral, left side */
.bubbleAssistant {
  /* Less rounded bottom-left corner */
  border-bottom-left-radius: var(--radius-sm);
}

/* System message styling - centered, muted */
.bubbleSystem {
  background-color: var(--color-warning-light);
  color: var(--color-text-primary);
  text-align: center;

  /* Full width for system messages */
  max-width: 100%;
}

/* Streaming message - subtle indicator */
.bubbleStreaming {
  /* Slight opacity to indicate in-progress */
  opacity: 0.95;
}

/* Activity bubble - contains interactive components like breathing exercises */
.bubbleActivity {
  /* Wider to accommodate activity UI */
  max-width: 100%;
  width: 100%;

  /* More padding for interactive content */
  padding: var(--spacing-md);

  /* Subtle gradient background for wellness feel */
  background: linear-gradient(
    135deg,
    var(--color-surface) 0%,
    var(--color-background-secondary) 100%
  );

  /* Slightly larger border radius for prominent cards */
  border-radius: var(--radius-xl);

  /* Enhanced shadow for elevated appearance */
  box-shadow: var(--shadow-md);

  /* Ensure content doesn't overflow */
  overflow: hidden;
}

/* Desktop: constrain activity width for better layout */
@media (min-width: 768px) {
  .bubbleActivity {
    max-width: 420px;
  }
}

/* Message text content */
.messageContent {
  /* Reset margins */
  margin: 0;

  /* Readable line height */
  line-height: var(--line-height-normal);

  /* Preserve whitespace and wrap long words */
  white-space: pre-wrap;
  word-break: break-word;
}

/* Blinking cursor for streaming messages */
.cursor {
  animation: blink 1s infinite;
  margin-left: 2px;
}

@keyframes blink {
  0%,
  50% {
    opacity: 1;
  }
  51%,
  100% {
    opacity: 0;
  }
}

/* ----------------------------------------------------------------------------
   Loading Indicator
   ----------------------------------------------------------------------------
   Organic breathing-like animation while waiting for AI response.
   Uses soft pulse instead of bounce for a calming effect.
   ---------------------------------------------------------------------------- */
.loadingIndicator {
  display: flex;
  gap: 6px;
  padding: var(--spacing-md);
  justify-content: flex-start;
  align-items: center;
}

.dot {
  width: 10px;
  height: 10px;
  background: linear-gradient(135deg, var(--color-sky) 0%, var(--color-lavender) 100%);
  border-radius: 50%;
  animation: breathePulse 2s var(--ease-breath) infinite;
}

.dot:nth-child(1) {
  animation-delay: 0s;
}
.dot:nth-child(2) {
  animation-delay: 0.3s;
}
.dot:nth-child(3) {
  animation-delay: 0.6s;
}

@keyframes breathePulse {
  0%,
  100% {
    transform: scale(0.8);
    opacity: 0.4;
  }
  50% {
    transform: scale(1.2);
    opacity: 1;
  }
}

/* ----------------------------------------------------------------------------
   Input Area
   ----------------------------------------------------------------------------
   Fixed at the bottom of the screen.
   Contains the text input and send button.
   ---------------------------------------------------------------------------- */
.inputArea {
  /* Fixed at bottom, doesn't scroll */
  flex-shrink: 0;

  /* Layout */
  display: flex;
  gap: var(--spacing-sm);
  padding: var(--spacing-md);

  /* Visual styling */
  background-color: var(--color-surface);
  border-top: 1px solid var(--border-color);

  /* Safe area padding for devices with notches/home indicators */
  padding-bottom: max(var(--spacing-md), env(safe-area-inset-bottom));
}

/* Text input field */
.input {
  /* Grow to fill available space */
  flex: 1;

  /* Sizing */
  padding: var(--spacing-sm) var(--spacing-md);
  min-height: 44px; /* Minimum touch target size */

  /* Typography */
  font-size: var(--font-size-base);
  color: var(--color-text-primary);

  /* Border styling */
  border: 1px solid var(--border-color);
  border-radius: var(--radius-full);
  background-color: var(--color-background);

  /* Focus state */
  outline: none;
  transition: border-color var(--transition-fast);
}

.input:focus {
  border-color: var(--color-primary);
}

.input:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.input::placeholder {
  color: var(--color-text-muted);
}

/* Send button */
.sendButton {
  /* Fixed size, circular */
  width: 44px;
  height: 44px;
  min-width: 44px;

  /* Center the icon */
  display: flex;
  align-items: center;
  justify-content: center;

  /* Styling */
  background-color: var(--color-primary);
  color: var(--color-text-inverse);
  border-radius: 50%;

  /* Transition for hover/disabled states */
  transition:
    background-color var(--transition-fast),
    opacity var(--transition-fast);
}

.sendButton:hover:not(:disabled) {
  background-color: var(--color-primary-hover);
}

.sendButton:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* ============================================================================
   Sidebar & Navigation Styles
   ============================================================================
   Mobile-first sidebar that slides in from the left.
   On desktop (768px+), sidebar is part of the layout and can be collapsed.
   ============================================================================ */

/* ----------------------------------------------------------------------------
   Overlay
   ----------------------------------------------------------------------------
   Semi-transparent backdrop shown when sidebar is open on mobile.
   Clicking it closes the sidebar.
   ---------------------------------------------------------------------------- */
.overlay {
  position: fixed;
  inset: 0;
  background-color: rgba(0, 0, 0, 0.3);
  z-index: 99;
  opacity: 0;
  animation: fadeIn var(--transition-fast) forwards;
}

@keyframes fadeIn {
  to {
    opacity: 1;
  }
}

/* Hide overlay on desktop - sidebar is part of layout */
@media (min-width: 768px) {
  .overlay {
    display: none;
  }
}

/* ----------------------------------------------------------------------------
   Sidebar
   ----------------------------------------------------------------------------
   Navigation panel with action buttons.
   Mobile: fixed overlay, slides in from left.
   Desktop: part of flex layout, can be collapsed.
   ---------------------------------------------------------------------------- */
.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: var(--sidebar-width);
  height: 100dvh;
  background: var(--gradient-sidebar);
  border-right: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  z-index: 100;

  /* Mobile: hidden by default, slide in */
  transform: translateX(-100%);
  transition:
    transform var(--transition-normal),
    width var(--transition-normal);
}

.sidebarOpen {
  transform: translateX(0);
}

/* Desktop: part of layout, open by default to avoid layout shift */
@media (min-width: 768px) {
  .sidebar {
    position: relative;
    flex-shrink: 0;
    transform: translateX(0);
    /* Open by default on desktop - no JS needed for initial state */
    width: var(--sidebar-width);
    overflow: hidden;
  }

  /* Only collapse when explicitly closed by user */
  .sidebarClosed {
    width: 0;
  }
}

/* ----------------------------------------------------------------------------
   Sidebar Navigation
   ----------------------------------------------------------------------------
   Main navigation area with action buttons.
   ---------------------------------------------------------------------------- */
.sidebarNav {
  flex: 1;
  padding: var(--spacing-md);
  overflow-y: auto;
}

/* ----------------------------------------------------------------------------
   Sidebar Profile
   ----------------------------------------------------------------------------
   User profile section at the top of the sidebar.
   ---------------------------------------------------------------------------- */
.sidebarProfile {
  padding: var(--spacing-md);
  padding-top: calc(var(--header-height) + var(--spacing-md));
  border-bottom: 1px solid var(--border-color);
}

@media (min-width: 768px) {
  .sidebarProfile {
    padding-top: calc(var(--spacing-3xl) + var(--spacing-md));
  }
}

/* ----------------------------------------------------------------------------
   Sidebar Section
   ----------------------------------------------------------------------------
   Grouped section within sidebar navigation.
   ---------------------------------------------------------------------------- */
.sidebarSection {
  margin-top: var(--spacing-md);
  padding-top: var(--spacing-md);
  border-top: 1px solid var(--color-neutral-100);
}

.sidebarSection:first-child {
  margin-top: 0;
  padding-top: 0;
  border-top: none;
}

/* ----------------------------------------------------------------------------
   Sidebar Footer
   ----------------------------------------------------------------------------
   Contains logout and other secondary actions.
   ---------------------------------------------------------------------------- */
.sidebarFooter {
  padding: var(--spacing-md);
  border-top: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

/* Theme toggle wrapper */
.themeToggleWrapper {
  display: flex;
  justify-content: center;
  padding-bottom: var(--spacing-xs);
}

/* ----------------------------------------------------------------------------
   Sidebar Button
   ----------------------------------------------------------------------------
   Full-width button with icon and text label.
   ---------------------------------------------------------------------------- */
.sidebarButton {
  width: 100%;
  min-height: 48px;
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm) var(--spacing-md);
  color: var(--color-text-primary);
  border-radius: var(--radius-md);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  text-align: left;
  transition:
    background-color var(--transition-fast),
    transform var(--transition-fast);

  /* Prevent text selection on rapid taps */
  -webkit-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.sidebarButton:hover {
  background-color: var(--color-primary-light);
}

.sidebarButton:active {
  transform: scale(0.98);
}

/* ----------------------------------------------------------------------------
   Menu Button (Mobile)
   ----------------------------------------------------------------------------
   Hamburger menu toggle in the header for mobile.
   Hidden on desktop where sidebar is always accessible.
   ---------------------------------------------------------------------------- */
.menuButton {
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--color-text-secondary);
  border-radius: var(--radius-md);
  position: absolute;
  left: var(--spacing-md);
  transition:
    background-color var(--transition-fast),
    color var(--transition-fast);

  /* Prevent text selection on rapid taps */
  -webkit-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.menuButton:hover {
  background-color: var(--color-primary-light);
  color: var(--color-primary);
}

/* Hide on desktop - use expand button instead */
@media (min-width: 768px) {
  .menuButton {
    display: none;
  }
}

/* ----------------------------------------------------------------------------
   Expand Button (Desktop)
   ----------------------------------------------------------------------------
   Shows when sidebar is collapsed on desktop.
   Clicking expands the sidebar.
   ---------------------------------------------------------------------------- */
.expandButton {
  display: none; /* Hidden on mobile */
}

@media (min-width: 768px) {
  .expandButton {
    display: flex;
    width: 40px;
    height: 40px;
    align-items: center;
    justify-content: center;
    color: var(--color-text-secondary);
    border-radius: var(--radius-md);
    position: absolute;
    left: var(--spacing-md);
    transition:
      background-color var(--transition-fast),
      color var(--transition-fast);
  }

  .expandButton:hover {
    background-color: var(--color-primary-light);
    color: var(--color-primary);
  }
}

/* ----------------------------------------------------------------------------
   Collapse Button (Desktop)
   ----------------------------------------------------------------------------
   Inside the sidebar, allows collapsing on desktop.
   Hidden on mobile.
   ---------------------------------------------------------------------------- */
.collapseButton {
  display: none; /* Hidden on mobile */
}

@media (min-width: 768px) {
  .collapseButton {
    display: flex;
    width: 32px;
    height: 32px;
    align-items: center;
    justify-content: center;
    color: var(--color-text-secondary);
    border-radius: var(--radius-md);
    position: absolute;
    top: var(--spacing-md);
    right: var(--spacing-md);
    transition:
      background-color var(--transition-fast),
      color var(--transition-fast);
  }

  .collapseButton:hover {
    background-color: var(--color-primary-light);
    color: var(--color-primary);
  }
}

/* ----------------------------------------------------------------------------
   Chat Main Area
   ----------------------------------------------------------------------------
   Contains the header, messages, and input.
   Takes remaining space after sidebar.
   ---------------------------------------------------------------------------- */
.chatMain {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-width: 0; /* Prevent flex item from overflowing */
}

/* ----------------------------------------------------------------------------
   Completed Activity Summary
   ----------------------------------------------------------------------------
   Displays historical activities as non-interactive completion summaries.
   ---------------------------------------------------------------------------- */
.completedActivity {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs) 0;
}

.completedIcon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background-color: var(--color-success-light, rgba(34, 197, 94, 0.1));
  color: var(--color-success, #22c55e);
  flex-shrink: 0;
}

.completedInfo {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.completedTitle {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  color: var(--color-text-primary);
}

.completedDetail {
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
}

/* ----------------------------------------------------------------------------
   Journal Entry Viewer Overlay
   ----------------------------------------------------------------------------
   Modal overlay for viewing past journal entries.
   ---------------------------------------------------------------------------- */
.journalOverlay {
  position: fixed;
  inset: 0;
  background-color: rgba(0, 0, 0, 0.6);
  z-index: 200;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-lg);
  animation: fadeIn var(--transition-fast) forwards;
}

.journalViewer {
  position: relative;
  width: 100%;
  max-width: 600px;
  max-height: 80vh;
  background-color: var(--color-surface);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  overflow-y: auto;
  padding: var(--spacing-lg);
  animation: slideUp var(--transition-normal) forwards;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.journalCloseButton {
  position: absolute;
  top: var(--spacing-md);
  right: var(--spacing-md);
  padding: var(--spacing-xs);
  background: transparent;
  border: none;
  border-radius: var(--radius-md);
  cursor: pointer;
  color: var(--color-text-muted);
  transition:
    color var(--transition-fast),
    background-color var(--transition-fast);
}

.journalCloseButton:hover {
  color: var(--color-text-primary);
  background-color: var(--color-neutral-100);
}

.journalHeader {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  margin-bottom: var(--spacing-md);
}

.journalCategory {
  font-size: var(--font-size-xs);
  padding: 4px 12px;
  border-radius: var(--radius-full);
  color: white;
  font-weight: var(--font-weight-medium);
  text-transform: capitalize;
}

.journalDate {
  font-size: var(--font-size-sm);
  color: var(--color-text-muted);
}

.journalPrompt {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-medium);
  color: var(--color-text-primary);
  margin-bottom: var(--spacing-md);
  padding-bottom: var(--spacing-md);
  border-bottom: 1px solid var(--border-color);
}

.journalContent {
  font-size: var(--font-size-base);
  color: var(--color-text-secondary);
  line-height: 1.7;
  white-space: pre-wrap;
  margin-bottom: var(--spacing-md);
}

.journalMeta {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  font-size: var(--font-size-sm);
  color: var(--color-text-muted);
  padding-top: var(--spacing-md);
  border-top: 1px solid var(--border-color);
}

.journalMeta .favorite {
  color: var(--color-warning);
}
